# 导入覆盖功能测试指南

## 测试概述
本测试指南用于验证各个模块的导入覆盖功能是否正常工作。

## 测试前准备
1. 确保数据库连接正常
2. 确保Python环境包含必要依赖：pandas, sqlalchemy, pymysql
3. 准备测试用的CSV/Excel文件

## 测试步骤

### 1. 社保信息导入测试
**接口**: `POST /api/social-insurance/import`

**测试数据示例** (social_test.csv):
```csv
姓名,个人医疗,个人养老,个人失业,公司医疗,公司养老,公司失业,公司工伤,年月
张三,100,200,50,150,300,75,25,2024-01-01
李四,110,210,55,160,310,80,30,2024-01-01
```

**测试流程**:
1. 第一次导入上述数据
2. 修改张三的数据（如个人医疗改为120）
3. 再次导入，验证张三的数据是否被覆盖

### 2. 补贴合计导入测试
**接口**: `POST /api/subsidy-summary/import`

**测试数据示例** (subsidy_test.csv):
```csv
姓名,部门,职位,部门负责人补贴,岗位津贴,油补,餐补8元/天,年月
张三,技术部,工程师,500,200,300,240,2024-01-01
李四,市场部,专员,0,150,200,240,2024-01-01
```

### 3. 朋友圈扣款导入测试
**接口**: `POST /api/friend-circle-payment/import`

**测试数据示例** (friend_circle_test.csv):
```csv
姓名,第一周,第二周,第三周,第四周,扣款,是否完成,年月
张三,5,3,4,6,50,1,2024-01-01
李四,2,4,3,5,40,0,2024-01-01
```

### 4. 考勤扣款导入测试
**接口**: `POST /api/attendance-deduction/import`

**测试数据示例** (attendance_test.csv):
```csv
姓名,考勤扣款,全勤奖励,年月,备注
张三,0,100,2024-01-01,全勤
李四,50,0,2024-01-01,迟到2次
```

### 5. 保证金导入测试
**接口**: `POST /api/deposit/upload`

**测试数据示例** (deposit_test.csv):
```csv
姓名,保证金扣除,扣除日期,备注
张三,1000,2024-01-15,入职保证金
李四,500,2024-01-20,培训保证金
```

## 验证要点

### 覆盖功能验证
1. **初始导入**: 确认数据正确插入
2. **重复导入**: 确认相同姓名+年月的数据被覆盖
3. **混合导入**: 确认新员工添加，现有员工更新
4. **跨月验证**: 确认不同月份的数据不相互影响

### 错误处理验证
1. **数据格式错误**: 验证错误记录被正确标记
2. **必填字段缺失**: 验证相应错误提示
3. **部分失败**: 验证部分记录失败不影响其他记录

### 数据库验证
使用SQL查询验证：
```sql
-- 检查特定员工特定月份的记录数量
SELECT COUNT(*) FROM sys_social_insurance 
WHERE name = '张三' AND DATE_FORMAT(yearMonth, '%Y-%m') = '2024-01';

-- 应该返回1（覆盖后只有一条记录）
```

## 预期结果
1. 所有接口都应该支持覆盖功能
2. 覆盖操作应该在事务中完成
3. 错误记录应该被正确报告
4. 成功记录应该正确更新数据库

## 故障排除
1. **Python脚本错误**: 检查环境变量和依赖
2. **数据库连接错误**: 检查连接配置
3. **文件格式错误**: 确认CSV/Excel格式正确
4. **权限错误**: 确认用户具有相应的管理员权限 